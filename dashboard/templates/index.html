<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>METHEFOR Finansal √ñzg√ºrl√ºk v2.0</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="https://s3.tradingview.com/tv.js"></script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --gold: #ffd700;
        --dark-bg: #0a0e27;
        --success: #10b981;
        --danger: #ef4444;
        --warning: #f59e0b;
        --info: #3b82f6;
      }

      body {
        font-family: 'Segoe UI', sans-serif;
        background: linear-gradient(135deg, #0a0e27 0%, #1e293b 100%);
        color: white;
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
      }

      #particles-js {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 0;
      }

      .container {
        position: relative;
        z-index: 1;
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      header {
        text-align: center;
        padding: 40px 20px;
        background: rgba(10, 14, 39, 0.6);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        margin-bottom: 30px;
        border: 2px solid var(--gold);
      }

      .logo {
        font-size: 3em;
        font-weight: bold;
        color: var(--gold);
        margin-bottom: 10px;
      }

      .tagline {
        font-size: 1.2em;
        color: #94a3b8;
        letter-spacing: 2px;
      }

      .live-indicator {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin-top: 15px;
        padding: 8px 16px;
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid var(--success);
        border-radius: 20px;
      }

      .pulse {
        width: 10px;
        height: 10px;
        background: var(--success);
        border-radius: 50%;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
          transform: scale(1.2);
        }
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(10px);
        padding: 25px;
        border-radius: 15px;
        border: 1px solid rgba(255, 215, 0, 0.2);
        text-align: center;
        transition: all 0.3s;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        border-color: var(--gold);
      }

      .stat-icon {
        font-size: 2.5em;
        margin-bottom: 10px;
      }
      .stat-value {
        font-size: 2.5em;
        font-weight: bold;
        margin: 10px 0;
      }
      .stat-label {
        color: #94a3b8;
        font-size: 0.9em;
        text-transform: uppercase;
      }

      .stat-card.buy .stat-value {
        color: var(--success);
      }
      .stat-card.sell .stat-value {
        color: var(--danger);
      }
      .stat-card.news .stat-value {
        color: var(--info);
      }

      .main-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
      }

      .panel {
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(10px);
        padding: 25px;
        border-radius: 15px;
        border: 1px solid rgba(255, 215, 0, 0.2);
      }

      .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--gold);
      }

      .panel-title {
        font-size: 1.3em;
        font-weight: bold;
        color: var(--gold);
      }

      .refresh-btn {
        background: var(--gold);
        color: var(--dark-bg);
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
      }

      .signal-card {
        background: rgba(30, 41, 59, 0.5);
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 15px;
        border-left: 4px solid var(--gold);
        cursor: pointer;
        transition: all 0.3s;
      }

      .signal-card:hover {
        background: rgba(30, 41, 59, 0.8);
        transform: translateX(5px);
      }

      .signal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .signal-symbol {
        font-size: 1.3em;
        font-weight: bold;
      }

      .signal-badge {
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 0.85em;
        font-weight: bold;
        text-transform: uppercase;
      }

      .signal-badge.hold {
        background: rgba(245, 158, 11, 0.3);
        color: var(--warning);
        border: 2px solid var(--warning);
      }

      .signal-badge.buy {
        background: rgba(16, 185, 129, 0.3);
        color: var(--success);
        border: 2px solid var(--success);
      }

      .signal-badge.sell {
        background: rgba(239, 68, 68, 0.3);
        color: var(--danger);
        border: 2px solid var(--danger);
      }

      .signal-details {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        font-size: 0.9em;
      }

      .signal-detail {
        color: #94a3b8;
      }

      .signal-detail strong {
        color: white;
        display: block;
        margin-top: 3px;
      }

      .news-item {
        background: rgba(30, 41, 59, 0.5);
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 12px;
        border-left: 3px solid var(--info);
      }

      .news-title {
        font-weight: bold;
        margin-bottom: 8px;
        font-size: 0.95em;
      }

      .news-meta {
        display: flex;
        justify-content: space-between;
        font-size: 0.8em;
        color: #94a3b8;
      }

      .sentiment-badge {
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.75em;
      }

      .sentiment-positive {
        background: rgba(16, 185, 129, 0.3);
        color: var(--success);
      }
      .sentiment-negative {
        background: rgba(239, 68, 68, 0.3);
        color: var(--danger);
      }
      .sentiment-neutral {
        background: rgba(148, 163, 184, 0.3);
        color: #94a3b8;
      }

      /* MODAL STYLES */
      .modal {
        display: none;
        position: fixed;
        z-index: 99999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(5px);
      }

      .modal.active {
        display: flex !important;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .modal-content {
        background: var(--dark-bg);
        border-radius: 20px;
        border: 2px solid var(--gold);
        max-width: 1200px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
        position: relative;
      }

      .modal-close {
        position: sticky;
        top: 0;
        right: 0;
        float: right;
        font-size: 2em;
        color: var(--gold);
        cursor: pointer;
        background: var(--dark-bg);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 15px 15px 0 0;
        z-index: 10;
        transition: all 0.3s;
      }

      .modal-close:hover {
        background: rgba(255, 215, 0, 0.2);
        transform: rotate(90deg);
      }

      .modal-header-new {
        text-align: center;
        padding: 30px 30px 20px;
        border-bottom: 2px solid var(--gold);
      }

      .modal-symbol-large {
        font-size: 2.5em;
        font-weight: bold;
        color: var(--gold);
        margin-bottom: 15px;
      }

      .signal-badge-large {
        display: inline-block;
        padding: 10px 20px;
        border-radius: 25px;
        font-size: 1em;
        font-weight: bold;
        text-transform: uppercase;
        margin-bottom: 15px;
      }

      .signal-badge-large.hold {
        background: rgba(245, 158, 11, 0.3);
        color: var(--warning);
        border: 2px solid var(--warning);
      }

      .signal-badge-large.buy {
        background: rgba(16, 185, 129, 0.3);
        color: var(--success);
        border: 2px solid var(--success);
      }

      .signal-badge-large.sell {
        background: rgba(239, 68, 68, 0.3);
        color: var(--danger);
        border: 2px solid var(--danger);
      }

      .modal-meta {
        display: flex;
        justify-content: center;
        gap: 30px;
        font-size: 1.1em;
        color: #94a3b8;
      }

      .modal-section-full {
        padding: 20px 30px;
      }

      .modal-section-title {
        font-size: 1.3em;
        color: var(--gold);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .info-grid-3col {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        padding: 20px 30px;
      }

      .info-card {
        background: rgba(30, 41, 59, 0.5);
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid rgba(255, 215, 0, 0.1);
      }

      .info-card-header {
        background: rgba(255, 215, 0, 0.1);
        padding: 15px;
        font-weight: bold;
        font-size: 1.1em;
        border-bottom: 2px solid var(--gold);
      }

      .info-card-body {
        padding: 15px;
      }

      .info-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      .info-row:last-child {
        border-bottom: none;
      }

      .info-label {
        color: #94a3b8;
        font-size: 0.9em;
      }

      .info-value {
        color: white;
        font-weight: bold;
      }

      .info-value-lg {
        font-size: 1.8em;
        font-weight: bold;
      }

      .recommendation-card {
        margin: 20px 30px 30px;
        background: rgba(30, 41, 59, 0.5);
        border-radius: 15px;
        padding: 20px;
        border-left: 4px solid var(--info);
      }

      .recommendation-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
        font-size: 1.2em;
        font-weight: bold;
      }

      .recommendation-icon {
        font-size: 1.5em;
      }

      .recommendation-body {
        font-size: 1.05em;
        line-height: 1.6;
        margin-bottom: 15px;
        color: #e2e8f0;
      }

      .recommendation-footer {
        font-size: 0.9em;
        color: #94a3b8;
        font-style: italic;
        padding-top: 10px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #94a3b8;
      }

      @media (max-width: 1024px) {
        .info-grid-3col {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 768px) {
        .main-grid {
          grid-template-columns: 1fr;
        }
        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <div id="particles-js"></div>

    <div class="container">
      <header>
        <div class="logo">üí∞ METHEFOR</div>
        <div class="tagline">Fƒ∞NANSAL √ñZG√úRL√úK</div>
        <div class="live-indicator">
          <div class="pulse"></div>
          <span>CANLI VERƒ∞ AKI≈ûI</span>
        </div>
      </header>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üìä</div>
          <div class="stat-value" id="total-signals">0</div>
          <div class="stat-label">Toplam Sinyal</div>
        </div>

        <div class="stat-card buy">
          <div class="stat-icon">üìà</div>
          <div class="stat-value" id="buy-signals">0</div>
          <div class="stat-label">Alƒ±m Sinyali</div>
        </div>

        <div class="stat-card sell">
          <div class="stat-icon">üìâ</div>
          <div class="stat-value" id="sell-signals">0</div>
          <div class="stat-label">Satƒ±m Sinyali</div>
        </div>

        <div class="stat-card news">
          <div class="stat-icon">üì∞</div>
          <div class="stat-value" id="news-count">0</div>
          <div class="stat-label">Aktif Haber</div>
        </div>
      </div>

      <div class="main-grid">
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">üìä En ƒ∞yi Sinyaller</div>
            <button class="refresh-btn" onclick="refreshData()">
              üîÑ Yenile
            </button>
          </div>
          <div id="signals-container">
            <div class="loading">Sinyaller y√ºkleniyor...</div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">üì∞ Son Haberler</div>
          </div>
          <div id="news-container">
            <div class="loading">Haberler y√ºkleniyor...</div>
          </div>
        </div>
      </div>
    </div>

    <div id="signal-modal" class="modal">
      <div class="modal-content">
        <span class="modal-close" onclick="closeModal()">&times;</span>
        <div id="modal-body"></div>
      </div>
    </div>

    <script>
      particlesJS('particles-js', {
        particles: {
          number: { value: 80 },
          color: { value: '#FFD700' },
          shape: { type: 'circle' },
          opacity: { value: 0.5 },
          size: { value: 3 },
          line_linked: {
            enable: true,
            distance: 150,
            color: '#FFD700',
            opacity: 0.2,
          },
          move: { enable: true, speed: 2 },
        },
      });

      const socket = io();
      let currentSignals = [];

      socket.on('connect', () => {
        console.log('Connected');
        refreshData();
      });

      async function refreshData() {
        try {
          const [summaryRes, newsRes] = await Promise.all([
            fetch('/api/summary'),
            fetch('/api/news?limit=10'),
          ]);

          const summaryData = await summaryRes.json();
          const newsData = await newsRes.json();

          const summary = summaryData.summary || summaryData;
          const news = newsData.news || newsData;

          updateStats(summary);
          updateSignals(summary.top_signals || summary.signals || []);
          updateNews(news);
        } catch (error) {
          console.error('Error:', error);
        }
      }

      function updateStats(summary) {
        const signals = summary.top_signals || summary.signals || [];

        const buyCount = signals.filter(
          (s) => s.decision === 'BUY' || s.decision === 'STRONG BUY'
        ).length;

        const sellCount = signals.filter(
          (s) => s.decision === 'SELL' || s.decision === 'STRONG SELL'
        ).length;

        const totalSignals = summary.total_signals || signals.length;
        const newsCount = summary.news_stats?.total || summary.news_count || 0;

        document.getElementById('total-signals').textContent = totalSignals;
        document.getElementById('buy-signals').textContent = buyCount;
        document.getElementById('sell-signals').textContent = sellCount;
        document.getElementById('news-count').textContent = newsCount;
      }

      function updateSignals(signals) {
        currentSignals = signals;
        const container = document.getElementById('signals-container');

        if (!signals || signals.length === 0) {
          container.innerHTML = '<div class="loading">Hen√ºz sinyal yok</div>';
          return;
        }

        container.innerHTML = signals
          .slice(0, 10)
          .map(
            (signal) => `
                <div class="signal-card" onclick="showSignalDetails('${
                  signal.symbol
                }')">
                    <div class="signal-header">
                        <div class="signal-symbol">üìä ${signal.symbol}</div>
                        <div class="signal-badge ${signal.decision
                          .toLowerCase()
                          .replace(' ', '-')}">
                            ${signal.decision}
                        </div>
                    </div>
                    <div class="signal-details">
                        <div class="signal-detail">
                            Skor: <strong>${signal.combined_score.toFixed(
                              1
                            )}/100</strong>
                        </div>
                        <div class="signal-detail">
                            G√ºven: <strong>${signal.confidence.toFixed(
                              1
                            )}%</strong>
                        </div>
                        <div class="signal-detail">
                            Fiyat: <strong>$${
                              signal.price?.current?.toFixed(2) || 'N/A'
                            }</strong>
                        </div>
                    </div>
                </div>
            `
          )
          .join('');
      }

      function updateNews(newsData) {
        const container = document.getElementById('news-container');

        let newsItems = [];
        if (Array.isArray(newsData)) {
          newsItems = newsData;
        } else if (newsData && typeof newsData === 'object') {
          newsItems = newsData.news || newsData.items || [];
        }

        if (!newsItems || newsItems.length === 0) {
          container.innerHTML = '<div class="loading">Hen√ºz haber yok</div>';
          return;
        }

        container.innerHTML = newsItems
          .slice(0, 10)
          .map((item) => {
            const sentiment = item.sentiment_label || 'neutral';
            const emoji =
              { positive: 'üü¢', negative: 'üî¥', neutral: '‚ö™' }[sentiment] ||
              '‚ö™';

            return `
                    <div class="news-item">
                        <div class="news-title">
                            ${emoji} ${
              item.title || item.headline || 'Ba≈ülƒ±k yok'
            }
                        </div>
                        <div class="news-meta">
                            <span>${item.source || 'Kaynak'}</span>
                            <span class="sentiment-badge sentiment-${sentiment}">
                                ${
                                  item.symbols
                                    ? item.symbols.join(', ')
                                    : 'Genel'
                                }
                            </span>
                        </div>
                    </div>
                `;
          })
          .join('');
      }

      function showSignalDetails(symbol) {
        const signal = currentSignals.find((s) => s.symbol === symbol);
        if (!signal) return;

        const modal = document.getElementById('signal-modal');
        const modalBody = document.getElementById('modal-body');

        const recommendation = generateRecommendation(signal);

        modalBody.innerHTML = `
                <div class="modal-header-new">
                    <div class="modal-symbol-large">üìä ${signal.symbol}</div>
                    <div class="signal-badge-large ${signal.decision
                      .toLowerCase()
                      .replace(' ', '-')}">
                        ${signal.decision}
                    </div>
                    <div class="modal-meta">
                        <span>Skor: ${signal.combined_score.toFixed(
                          1
                        )}/100</span>
                        <span>G√ºven: ${signal.confidence.toFixed(1)}%</span>
                    </div>
                </div>
                
                <div class="modal-section-full">
                    <div class="modal-section-title">üìà TradingView Canlƒ± Grafiƒüi</div>
                    <div id="tradingview-modal" style="height: 500px;"></div>
                </div>
                
                <div class="info-grid-3col">
                    <div class="info-card">
                        <div class="info-card-header">üí∞ Fiyat Bilgileri</div>
                        <div class="info-card-body">
                            <div class="info-row">
                                <span class="info-label">G√ºncel</span>
                                <span class="info-value-lg" style="color: ${
                                  signal.price?.change_1d >= 0
                                    ? 'var(--success)'
                                    : 'var(--danger)'
                                }">
                                    $${
                                      signal.price?.current?.toFixed(2) || 'N/A'
                                    }
                                </span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Deƒüi≈üim</span>
                                <span class="info-value">${
                                  signal.price?.change_1d >= 0 ? '+' : ''
                                }${
          signal.price?.change_1d?.toFixed(2) || '0'
        }%</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Hacim</span>
                                <span class="info-value">${
                                  signal.price?.volume
                                    ? (signal.price.volume / 1000000).toFixed(
                                        1
                                      ) + 'M'
                                    : 'N/A'
                                }</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Y√ºksek</span>
                                <span class="info-value">$${
                                  signal.price?.high?.toFixed(2) || 'N/A'
                                }</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">D√º≈ü√ºk</span>
                                <span class="info-value">$${
                                  signal.price?.low?.toFixed(2) || 'N/A'
                                }</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <div class="info-card-header">üìä Teknik Analiz</div>
                        <div class="info-card-body">
                            <div class="info-row">
                                <span class="info-label">Teknik Skor</span>
                                <span class="info-value-lg" style="color: ${
                                  signal.technical?.score >= 70
                                    ? 'var(--success)'
                                    : signal.technical?.score >= 40
                                    ? 'var(--warning)'
                                    : 'var(--danger)'
                                }">
                                    ${signal.technical?.score || 'N/A'}/100
                                </span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Karar</span>
                                <span class="info-value">${
                                  signal.technical?.decision || 'N/A'
                                }</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">RSI</span>
                                <span class="info-value" style="color: ${
                                  (signal.technical?.rsi || 50) < 30
                                    ? 'var(--success)'
                                    : (signal.technical?.rsi || 50) > 70
                                    ? 'var(--danger)'
                                    : 'white'
                                }">
                                    ${
                                      signal.technical?.rsi?.toFixed(1) || 'N/A'
                                    }
                                    ${
                                      (signal.technical?.rsi || 50) < 30
                                        ? ' üî•'
                                        : (signal.technical?.rsi || 50) > 70
                                        ? ' ‚ö†Ô∏è'
                                        : ''
                                    }
                                </span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Trend</span>
                                <span class="info-value">
                                    ${
                                      signal.technical?.trend === 'UPTREND'
                                        ? 'üìà Y√ºkseli≈ü'
                                        : signal.technical?.trend ===
                                          'DOWNTREND'
                                        ? 'üìâ D√º≈ü√º≈ü'
                                        : '‚û°Ô∏è Yatay'
                                    }
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <div class="info-card-header">üì∞ Sentiment Analiz</div>
                        <div class="info-card-body">
                            <div class="info-row">
                                <span class="info-label">Sentiment</span>
                                <span class="info-value-lg" style="color: ${
                                  (signal.sentiment?.score || 0) >= 0.5
                                    ? 'var(--success)'
                                    : (signal.sentiment?.score || 0) <= -0.5
                                    ? 'var(--danger)'
                                    : 'var(--warning)'
                                }">
                                    ${
                                      (signal.sentiment?.score || 0) >= 0
                                        ? '+'
                                        : ''
                                    }${
          signal.sentiment?.score?.toFixed(2) || '0'
        }
                                </span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Label</span>
                                <span class="info-value">
                                    ${
                                      signal.sentiment?.label === 'positive'
                                        ? 'üü¢ Pozitif'
                                        : signal.sentiment?.label === 'negative'
                                        ? 'üî¥ Negatif'
                                        : '‚ö™ N√∂tr'
                                    }
                                </span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Haber Sayƒ±sƒ±</span>
                                <span class="info-value">${
                                  signal.sentiment?.news_count || 0
                                }</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">G√ºven</span>
                                <span class="info-value">${
                                  signal.sentiment?.confidence?.toFixed(1) ||
                                  'N/A'
                                }%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                ${recommendation}
            `;

        modal.classList.add('active');

        setTimeout(() => {
          let tvSymbol = symbol;
          if (symbol.includes('-USD')) {
            tvSymbol = symbol.replace('-USD', 'USD');
          } else if (symbol.includes('.IS')) {
            tvSymbol = 'BIST:' + symbol.replace('.IS', '');
          } else {
            tvSymbol = 'NASDAQ:' + symbol;
          }

          new TradingView.widget({
            width: '100%',
            height: 500,
            symbol: tvSymbol,
            interval: 'D',
            timezone: 'Europe/Istanbul',
            theme: 'dark',
            locale: 'tr',
            toolbar_bg: '#0A0E27',
            container_id: 'tradingview-modal',
            studies: [
              'RSI@tv-basicstudies',
              'MACD@tv-basicstudies',
              'BB@tv-basicstudies',
            ],
          });
        }, 100);
      }

      function generateRecommendation(signal) {
        const techScore = signal.technical?.score || 0;
        const sentScore = ((signal.sentiment?.score || 0) + 1) * 50;
        const rsi = signal.technical?.rsi || 50;
        const decision = signal.decision;

        let recommendation = '';
        let icon = '';
        let color = '';

        if (
          decision === 'STRONG BUY' ||
          (techScore >= 75 && signal.confidence >= 65)
        ) {
          icon = 'üöÄ';
          color = 'var(--success)';
          recommendation = `<strong>G√º√ßl√º Alƒ±m Fƒ±rsatƒ±!</strong><br><br>
                    Teknik analiz √ßok g√º√ßl√º (${techScore}/100) ve g√ºven seviyesi y√ºksek (%${signal.confidence.toFixed(
            1
          )}). 
                    ${
                      rsi < 30
                        ? `RSI ${rsi.toFixed(
                            1
                          )} seviyesinde (oversold) - m√ºkemmel giri≈ü noktasƒ± olabilir! üî•`
                        : ''
                    }
                    ${
                      sentScore >= 60
                        ? 'Haberler de pozitif y√∂nde.'
                        : 'Ancak haberlerde dikkatli olun.'
                    }
                    <br><br>
                    üí° <em>Kendi ara≈ütƒ±rmanƒ±zƒ± yapƒ±n ve risk y√∂netimi kullanƒ±n.</em>`;
        } else if (decision === 'BUY' || techScore >= 60) {
          icon = 'üìà';
          color = 'var(--success)';
          recommendation = `<strong>Alƒ±m ƒ∞√ßin Uygun Seviye</strong><br><br>
                    Teknik g√∂stergeler olumlu (${techScore}/100). 
                    ${
                      rsi < 40
                        ? `RSI ${rsi.toFixed(1)} - normal seviyelerin altƒ±nda.`
                        : ''
                    }
                    Pozisyon a√ßmak i√ßin uygun olabilir.
                    <br><br>
                    ‚ö†Ô∏è <em>Stop loss kullanmayƒ± unutmayƒ±n!</em>`;
        } else if (decision === 'HOLD') {
          icon = '‚è∏Ô∏è';
          color = 'var(--warning)';
          recommendation = `<strong>Bekleme Durumu</strong><br><br>
                    Teknik: ${techScore}/100, Sentiment: ${sentScore.toFixed(
            0
          )}/100
                    <br><br>
                    ≈ûu an net bir sinyal yok. ${
                      techScore >= 50 ? 'Teknik olumlu ama' : 'Teknik zayƒ±f ve'
                    } 
                    ${
                      sentScore >= 50
                        ? 'haberler pozitif.'
                        : 'haberlerde belirsizlik var.'
                    }
                    <br><br>
                    üí° <em>Pozisyon varsa tutun, yoksa beklemeniz √∂nerilir.</em>`;
        } else if (decision === 'SELL') {
          icon = 'üìâ';
          color = 'var(--danger)';
          recommendation = `<strong>Satƒ±≈ü Sinyali</strong><br><br>
                    Teknik g√∂stergeler zayƒ±flamƒ±≈ü (${techScore}/100). 
                    ${
                      rsi > 70
                        ? `RSI ${rsi.toFixed(
                            1
                          )} (overbought) - a≈üƒ±rƒ± alƒ±m b√∂lgesinde!`
                        : ''
                    }
                    Pozisyon varsa k√¢r realizasyonu d√º≈ü√ºn√ºlebilir.
                    <br><br>
                    üí∞ <em>Kar hedeflerinizi g√∂zden ge√ßirin.</em>`;
        } else {
          icon = '‚ö†Ô∏è';
          color = 'var(--danger)';
          recommendation = `<strong>G√º√ßl√º Satƒ±≈ü Sinyali</strong><br><br>
                    Hem teknik hem sentiment zayƒ±f. Risk y√∂netimini g√∂zden ge√ßirin.
                    <br><br>
                    üõë <em>Stop loss seviyelerinizi kontrol edin!</em>`;
        }

        return `
                <div class="recommendation-card" style="border-left-color: ${color};">
                    <div class="recommendation-header">
                        <span class="recommendation-icon">${icon}</span>
                        <span class="recommendation-title">AI Analiz ve √ñneri</span>
                    </div>
                    <div class="recommendation-body">
                        ${recommendation}
                    </div>
                    <div class="recommendation-footer">
                        ‚ö†Ô∏è Bu bir yatƒ±rƒ±m tavsiyesi deƒüildir. Kendi ara≈ütƒ±rmanƒ±zƒ± yapƒ±n ve profesyonel danƒ±≈üman g√∂r√º≈ü√º alƒ±n.
                    </div>
                </div>
            `;
      }

      function closeModal() {
        document.getElementById('signal-modal').classList.remove('active');
      }

      document.getElementById('signal-modal').addEventListener('click', (e) => {
        if (e.target.id === 'signal-modal') closeModal();
      });

      window.addEventListener('load', () => {
        refreshData();
        setInterval(refreshData, 30000);
      });
    </script>
  </body>
</html>
